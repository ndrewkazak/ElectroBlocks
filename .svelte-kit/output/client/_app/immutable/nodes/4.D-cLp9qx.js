import{s as ue,n as W,r as re,w as X,t as ze,a as Ee,b as $e}from"../chunks/scheduler.ydM6q-DU.js";import{S as ie,i as ce,e as g,w as R,s as I,c as b,o as y,x as q,d,a as A,g as se,f as o,B as $,b as j,q as c,A as G,z as x,D as ae,K as Ue,C as ye,N as Me,n as fe,p as de,h as He,r as pe,l as he,t as _e,u as me}from"../chunks/index.DrhsS78m.js";import{V as Ve}from"../chunks/VerticalComponentContainer.P-NAKX1g.js";import{e as ee,u as Be,d as je}from"../chunks/each.Di7i0pvy.js";import{P as O,a as M,b as F,c as oe,t as Z}from"../chunks/Blockly.svelte_svelte_type_style_lang.Dxe9craf.js";import{c as Ge}from"../chunks/code.store.ByWLoW46.js";import{c as Re}from"../chunks/env.BVG2RuTF.js";import{g as qe}from"../chunks/arduino-component-id.XfWJa0Y3.js";import{o as le,t as Ce}from"../chunks/alerts.DcEBuQUd.js";function Te(n,e,t){const s=n.slice();return s[9]=e[t],s}function Oe(n,e,t){const s=n.slice();return s[12]=e[t],s[14]=t,s}function ke(n){let e=n[9].value+"",t;return{c(){t=R(e)},l(s){t=q(s,e)},m(s,l){j(s,t,l)},p(s,l){l&1&&e!==(e=s[9].value+"")&&x(t,e)},d(s){s&&d(t)}}}function Se(n){let e,t=Pe(n[9].value)+"",s;return{c(){e=g("span"),s=R(t),this.h()},l(l){e=b(l,"SPAN",{style:!0,class:!0});var a=y(e);s=q(a,t),a.forEach(d),this.h()},h(){ae(e,"color",n[3](n[9].value)),o(e,"class","coloredElement svelte-1uy08jn")},m(l,a){j(l,e,a),c(e,s)},p(l,a){a&1&&t!==(t=Pe(l[9].value)+"")&&x(s,t),a&1&&ae(e,"color",l[3](l[9].value))},d(l){l&&d(e)}}}function Le(n){let e,t=ee(we(n[9].value)),s=[];for(let l=0;l<t.length;l+=1)s[l]=Ne(Oe(n,t,l));return{c(){e=g("span");for(let l=0;l<s.length;l+=1)s[l].c();this.h()},l(l){e=b(l,"SPAN",{class:!0});var a=y(e);for(let r=0;r<s.length;r+=1)s[r].l(a);a.forEach(d),this.h()},h(){o(e,"class","colorValue svelte-1uy08jn")},m(l,a){j(l,e,a);for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(e,null)},p(l,a){if(a&1){t=ee(we(l[9].value));let r;for(r=0;r<t.length;r+=1){const u=Oe(l,t,r);s[r]?s[r].p(u,a):(s[r]=Ne(u),s[r].c(),s[r].m(e,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=t.length}},d(l){l&&d(e),Ue(s,l)}}}function Ne(n){let e,t=n[14]+1+"",s,l;return{c(){e=g("span"),s=R(t),l=I(),this.h()},l(a){e=b(a,"SPAN",{style:!0,class:!0});var r=y(e);s=q(r,t),l=A(r),r.forEach(d),this.h()},h(){ae(e,"background-color",oe(n[12])),o(e,"class","coloredElement svelte-1uy08jn")},m(a,r){j(a,e,r),c(e,s),c(e,l)},p(a,r){r&1&&ae(e,"background-color",oe(a[12]))},d(a){a&&d(e)}}}function De(n,e){let t,s,l=e[9].name+"",a,r,u,C=e[9].type+"",S,T,_,m,k,N,p=e[9].type!=="Colour"&&e[9].type!=="List Colour"&&ke(e),f=e[9].type==="Colour"&&Se(e),h=e[9].type==="List Colour"&&Le(e);return{key:n,first:null,c(){t=g("tr"),s=g("td"),a=R(l),r=I(),u=g("td"),S=R(C),T=I(),_=g("td"),p&&p.c(),m=I(),f&&f.c(),k=I(),h&&h.c(),N=I(),this.h()},l(B){t=b(B,"TR",{class:!0});var i=y(t);s=b(i,"TD",{class:!0});var P=y(s);a=q(P,l),P.forEach(d),r=A(i),u=b(i,"TD",{class:!0});var V=y(u);S=q(V,C),V.forEach(d),T=A(i),_=b(i,"TD",{class:!0});var U=y(_);p&&p.l(U),m=A(U),f&&f.l(U),k=A(U),h&&h.l(U),U.forEach(d),N=A(i),i.forEach(d),this.h()},h(){o(s,"class","svelte-1uy08jn"),o(u,"class","svelte-1uy08jn"),o(_,"class","svelte-1uy08jn"),o(t,"class","svelte-1uy08jn"),$(t,"coloredElement",e[9].type==="Colour"),this.first=t},m(B,i){j(B,t,i),c(t,s),c(s,a),c(t,r),c(t,u),c(u,S),c(t,T),c(t,_),p&&p.m(_,null),c(_,m),f&&f.m(_,null),c(_,k),h&&h.m(_,null),c(t,N)},p(B,i){e=B,i&1&&l!==(l=e[9].name+"")&&x(a,l),i&1&&C!==(C=e[9].type+"")&&x(S,C),e[9].type!=="Colour"&&e[9].type!=="List Colour"?p?p.p(e,i):(p=ke(e),p.c(),p.m(_,m)):p&&(p.d(1),p=null),e[9].type==="Colour"?f?f.p(e,i):(f=Se(e),f.c(),f.m(_,k)):f&&(f.d(1),f=null),e[9].type==="List Colour"?h?h.p(e,i):(h=Le(e),h.c(),h.m(_,null)):h&&(h.d(1),h=null),i&1&&$(t,"coloredElement",e[9].type==="Colour")},d(B){B&&d(t),p&&p.d(),f&&f.d(),h&&h.d()}}}function Ke(n){let e,t,s,l,a,r,u,C,S,T,_,m,k,N='<tr class="svelte-1uy08jn"><th class="svelte-1uy08jn">Variable Name</th> <th class="svelte-1uy08jn">Data Type</th> <th class="svelte-1uy08jn">Value</th></tr>',p,f,h=[],B=new Map,i,P,V=ee(n[0]);const U=E=>E[9].id;for(let E=0;E<V.length;E+=1){let D=Te(n,V,E),z=U(D);B.set(z,h[E]=De(z,D))}return{c(){e=g("div"),t=g("h3"),s=R(`Debug
    `),l=g("span"),a=g("i"),r=I(),u=g("i"),C=I(),S=g("i"),T=I(),_=g("div"),m=g("table"),k=g("thead"),k.innerHTML=N,p=I(),f=g("tbody");for(let E=0;E<h.length;E+=1)h[E].c();this.h()},l(E){e=b(E,"DIV",{id:!0,class:!0});var D=y(e);t=b(D,"H3",{class:!0});var z=y(t);s=q(z,`Debug
    `),l=b(z,"SPAN",{class:!0});var K=y(l);a=b(K,"I",{class:!0}),y(a).forEach(d),r=A(K),u=b(K,"I",{class:!0}),y(u).forEach(d),C=A(K),S=b(K,"I",{class:!0}),y(S).forEach(d),K.forEach(d),z.forEach(d),T=A(D),_=b(D,"DIV",{id:!0,class:!0});var J=y(_);m=b(J,"TABLE",{id:!0,class:!0});var Q=y(m);k=b(Q,"THEAD",{"data-svelte-h":!0}),se(k)!=="svelte-1kh807k"&&(k.innerHTML=N),p=A(Q),f=b(Q,"TBODY",{id:!0});var te=y(f);for(let Y=0;Y<h.length;Y+=1)h[Y].l(te);te.forEach(d),Q.forEach(d),J.forEach(d),D.forEach(d),this.h()},h(){o(a,"class","fa fa-play svelte-1uy08jn"),$(a,"not-active",n[2]),o(u,"class","fa fa-stop svelte-1uy08jn"),$(u,"not-active",n[2]),o(S,"class","fa fa-bug svelte-1uy08jn"),$(S,"debug-start",n[1]),o(l,"class","svelte-1uy08jn"),o(t,"class","svelte-1uy08jn"),o(f,"id","variable-tbody"),o(m,"id","variable-table"),o(m,"class","svelte-1uy08jn"),o(_,"id","variable-table-container"),o(_,"class","svelte-1uy08jn"),o(e,"id","debug"),o(e,"class","svelte-1uy08jn")},m(E,D){j(E,e,D),c(e,t),c(t,s),c(t,l),c(l,a),c(l,r),c(l,u),c(l,C),c(l,S),c(e,T),c(e,_),c(_,m),c(m,k),c(m,p),c(m,f);for(let z=0;z<h.length;z+=1)h[z]&&h[z].m(f,null);i||(P=[G(a,"click",n[4]),G(u,"click",n[5])],i=!0)},p(E,[D]){D&4&&$(a,"not-active",E[2]),D&4&&$(u,"not-active",E[2]),D&2&&$(S,"debug-start",E[1]),D&9&&(V=ee(E[0]),h=Be(h,D,U,1,E,V,B,f,je,De,null,Te))},i:W,o:W,d(E){E&&d(e);for(let D=0;D<h.length;D+=1)h[D].d();i=!1,re(P)}}}function Pe(n){const[e,t,s]=n.replace("{","").replace("}","").split("-").map(l=>parseInt(l,0));return`(red=${e},green=${t},blue=${s})`}function we(n){return n.replace("[","").replace("]","").split(",").map(e=>{const[t,s,l]=e.replace("{","").replace("}","").split("-").map(a=>parseInt(a,0));return{red:t,green:s,blue:l}})}function Ye(n,e,t){let s,l=[],a=[],r=O.CLOSE,u=!1,C=!1;M.subscribe(m=>{t(6,r=m),r===O.CLOSE&&t(1,C=!1)}),F.subscribe(m=>{if(!m||(m.message.includes("START_DEBUG")&&t(1,C=!0),m.type==="Computer"))return;if(m.message.includes("DEBUG_BLOCK_")){t(0,l=[...a]),a=[],t(7,u=!0);return}if(!m.message.includes("**(|)"))return;const[k,N,p]=m.message.replace("**(|)","").split("_|_"),f=a.findIndex(h=>h.name===k);if(f>-1){a[f]={name:k,type:N,value:p};return}a.push({name:k,type:N,value:p})});function S(m){const[k,N,p]=m.replace("{","").replace("}","").split("-").map(f=>parseInt(f,0));return oe({red:k,green:N,blue:p})}function T(){u&&(F.sendMessage("continue_debug"),t(7,u=!1))}function _(){u&&(F.sendMessage("stop_debug"),t(7,u=!1))}return n.$$.update=()=>{n.$$.dirty&192&&t(2,s=r!==O.OPEN||!u)},[l,C,s,S,T,_,r,u]}class Fe extends ie{constructor(e){super(),ce(this,e,Ye,Ke,ue,{})}}const Je=async(n,e,t)=>{const s=await Qe(n,t),l=new TextEncoder;return new Promise((a,r)=>{e.flash(l.encode(s),u=>{u?r(u):a("flash successful")})})},Qe=async(n,e)=>{const t=new Headers;return t.append("Content-Type","text/plain"),await(await fetch(`${Re.server_arduino_url}/upload-code/${e}`,{method:"POST",body:n,headers:t})).text()};function Ie(n,e,t){const s=n.slice();return s[16]=e[t],s}function Ae(n,e){let t,s,l,a,r,u,C=e[16].message+"",S,T,_=e[16].time+"",m,k,N;return{key:n,first:null,c(){t=g("article"),s=g("p"),l=g("img"),u=I(),S=R(C),T=R(`
        (`),m=R(_),k=R(")"),N=I(),this.h()},l(p){t=b(p,"ARTICLE",{class:!0});var f=y(t);s=b(f,"P",{});var h=y(s);l=b(h,"IMG",{src:!0,alt:!0,class:!0}),u=A(h),S=q(h,C),T=q(h,`
        (`),m=q(h,_),k=q(h,")"),h.forEach(d),N=A(f),f.forEach(d),this.h()},h(){Ee(l.src,a=e[16].type==="Computer"?"./laptop.png":"./cpu.png")||o(l,"src",a),o(l,"alt",r=e[16].type==="Computer"?"computer":"arduino"),o(l,"class","svelte-czu2g7"),o(t,"class","message-computer"),this.first=t},m(p,f){j(p,t,f),c(t,s),c(s,l),c(s,u),c(s,S),c(s,T),c(s,m),c(s,k),c(t,N)},p(p,f){e=p,f&4&&!Ee(l.src,a=e[16].type==="Computer"?"./laptop.png":"./cpu.png")&&o(l,"src",a),f&4&&r!==(r=e[16].type==="Computer"?"computer":"arduino")&&o(l,"alt",r),f&4&&C!==(C=e[16].message+"")&&x(S,C),f&4&&_!==(_=e[16].time+"")&&x(m,_)},d(p){p&&d(t)}}}function We(n){let e,t='<i class="fa fa-spinner fa-spin fa-6x fa-fw svelte-czu2g7"></i>';return{c(){e=g("button"),e.innerHTML=t,this.h()},l(s){e=b(s,"BUTTON",{class:!0,"data-svelte-h":!0}),se(e)!=="svelte-1c7tonu"&&(e.innerHTML=t),this.h()},h(){o(e,"class","svelte-czu2g7")},m(s,l){j(s,e,l)},p:W,d(s){s&&d(e)}}}function Xe(n){let e,t,s,l;return{c(){e=g("button"),t=g("i"),this.h()},l(a){e=b(a,"BUTTON",{title:!0,class:!0});var r=y(e);t=b(r,"I",{class:!0}),y(t).forEach(d),r.forEach(d),this.h()},h(){o(t,"class","fa svelte-czu2g7"),$(t,"fa-usb",n[0]===O.CLOSE),o(e,"title","Connect to Arduino"),o(e,"class","svelte-czu2g7")},m(a,r){j(a,e,r),c(e,t),s||(l=[X(Z.call(null,e)),G(e,"click",n[6])],s=!0)},p(a,r){r&1&&$(t,"fa-usb",a[0]===O.CLOSE)},d(a){a&&d(e),s=!1,re(l)}}}function Ze(n){let e,t,s,l;return{c(){e=g("button"),t=g("i"),this.h()},l(a){e=b(a,"BUTTON",{title:!0,class:!0});var r=y(e);t=b(r,"I",{class:!0}),y(t).forEach(d),r.forEach(d),this.h()},h(){o(t,"class","fa svelte-czu2g7"),$(t,"fa-eject",n[0]===O.OPEN),o(e,"title","Disconnect from Arduino"),o(e,"class","svelte-czu2g7")},m(a,r){j(a,e,r),c(e,t),s||(l=[X(Z.call(null,e)),G(e,"click",n[6])],s=!0)},p(a,r){r&1&&$(t,"fa-eject",a[0]===O.OPEN)},d(a){a&&d(e),s=!1,re(l)}}}function xe(n){let e,t=[],s=new Map,l,a,r,u,C,S,T,_,m,k,N,p,f,h,B,i,P,V='<i class="fa fa-trash svelte-czu2g7"></i>',U,E,D='<i class="fa fa-angle-double-down svelte-czu2g7"></i>',z,K,J=ee(n[2]);const Q=v=>v[16].id;for(let v=0;v<J.length;v+=1){let L=Ie(n,J,v),w=Q(L);s.set(w,t[v]=Ae(w,L))}function te(v,L){return v[0]==O.OPEN?Ze:v[0]===O.CLOSE?Xe:We}let Y=te(n),H=Y(n);return{c(){e=g("section");for(let v=0;v<t.length;v+=1)t[v].c();l=I(),a=g("section"),r=g("form"),u=g("input"),S=I(),T=g("button"),_=g("i"),k=I(),H.c(),N=I(),p=g("button"),f=g("i"),i=I(),P=g("button"),P.innerHTML=V,U=I(),E=g("button"),E.innerHTML=D,this.h()},l(v){e=b(v,"SECTION",{id:!0,class:!0});var L=y(e);for(let ne=0;ne<t.length;ne+=1)t[ne].l(L);L.forEach(d),l=A(v),a=b(v,"SECTION",{id:!0,class:!0});var w=y(a);r=b(w,"FORM",{class:!0});var ge=y(r);u=b(ge,"INPUT",{type:!0,placeholder:!0,class:!0}),ge.forEach(d),S=A(w),T=b(w,"BUTTON",{title:!0,class:!0});var be=y(T);_=b(be,"I",{class:!0}),y(_).forEach(d),be.forEach(d),k=A(w),H.l(w),N=A(w),p=b(w,"BUTTON",{title:!0,class:!0});var ve=y(p);f=b(ve,"I",{class:!0}),y(f).forEach(d),ve.forEach(d),i=A(w),P=b(w,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),se(P)!=="svelte-di86a3"&&(P.innerHTML=V),U=A(w),E=b(w,"BUTTON",{title:!0,class:!0,"data-svelte-h":!0}),se(E)!=="svelte-1r5mix8"&&(E.innerHTML=D),w.forEach(d),this.h()},h(){o(e,"id","messages"),o(e,"class","svelte-czu2g7"),u.readOnly=C=n[0]!==O.OPEN,o(u,"type","text"),o(u,"placeholder","send message"),o(u,"class","svelte-czu2g7"),o(r,"class","svelte-czu2g7"),o(_,"class","fa fa-paper-plane svelte-czu2g7"),o(T,"title","Send Message"),T.disabled=m=n[0]!==O.OPEN,o(T,"class","svelte-czu2g7"),o(f,"class",h="fa "+n[5]+" svelte-czu2g7"),o(p,"title","Upload code"),p.disabled=B=n[0]!==O.CLOSE,o(p,"class","svelte-czu2g7"),o(P,"title","Delete"),o(P,"class","svelte-czu2g7"),o(E,"title","Autoscroll"),o(E,"class","svelte-czu2g7"),$(E,"scroll-active",n[1]),o(a,"id","send-message-container"),o(a,"class","svelte-czu2g7")},m(v,L){j(v,e,L);for(let w=0;w<t.length;w+=1)t[w]&&t[w].m(e,null);n[11](e),j(v,l,L),j(v,a,L),c(a,r),c(r,u),ye(u,n[3]),c(a,S),c(a,T),c(T,_),c(a,k),H.m(a,null),c(a,N),c(a,p),c(p,f),c(a,i),c(a,P),c(a,U),c(a,E),z||(K=[G(u,"input",n[12]),G(r,"submit",Me(n[7])),X(Z.call(null,T)),G(T,"click",n[7]),X(Z.call(null,p)),G(p,"click",n[8]),X(Z.call(null,P)),G(P,"click",n[9]),X(Z.call(null,E)),G(E,"click",n[10])],z=!0)},p(v,[L]){L&4&&(J=ee(v[2]),t=Be(t,L,Q,1,v,J,s,e,je,Ae,null,Ie)),L&1&&C!==(C=v[0]!==O.OPEN)&&(u.readOnly=C),L&8&&u.value!==v[3]&&ye(u,v[3]),L&1&&m!==(m=v[0]!==O.OPEN)&&(T.disabled=m),Y===(Y=te(v))&&H?H.p(v,L):(H.d(1),H=Y(v),H&&(H.c(),H.m(a,N))),L&32&&h!==(h="fa "+v[5]+" svelte-czu2g7")&&o(f,"class",h),L&1&&B!==(B=v[0]!==O.CLOSE)&&(p.disabled=B),L&2&&$(E,"scroll-active",v[1])},i:W,o:W,d(v){v&&(d(e),d(l),d(a));for(let L=0;L<t.length;L+=1)t[L].d();n[11](null),H.d(),z=!1,re(K)}}}function et(n,e,t){let s;const l="To upload code you must use chrome or a chromium based browser like edge, or brave.  This will work with chrome version 89 or higher. ";let a=!1,r=[],u=O.CLOSE,C="",S,T,_;Ge.subscribe(i=>{S=i.code,T=i.boardType}),M.subscribe(i=>{t(0,u=i)}),F.subscribe(i=>{i&&(i.message.includes("C_D_B_C_D")&&F.sendMessage("START_DEBUG"),!(i.message.includes("**(|)")||i.message.includes("DEBUG_BLOCK_")||i.message.includes("stop_debug")||i.message.includes("continue_debug")||i.message.includes("START_DEBUG")||i.message.includes("C_D_B_C_D"))&&t(2,r=[...r,i]))});async function m(){if(!navigator.serial){le(l);return}if(u==O.OPEN){M.set(O.CLOSING);try{await F.closePort()}catch(P){le("Sorry, error with the arduino.  Please refresh your browser to disconnect.",P)}M.set(O.CLOSE);return}M.set(O.OPENNING);const i=qe(T);F.connect(i.serial_baud_rate).then(()=>{M.set(O.OPEN)}).catch(P=>{if(P.message.toLowerCase()==="no port selected by the user."){M.set(O.CLOSE);return}M.set(O.CLOSE),le("Sorry, please refresh your browser and try again.",P)})}function k(){if(u===O.OPEN)try{F.sendMessage(C),t(3,C="")}catch(i){console.log(i,"sendMessage error")}}async function N(){if(!navigator.serial){le(l);return}if(u===O.CLOSE){M.set(O.UPLOADING);try{const i=new AvrgirlArduino({board:T,debug:!0});await Je(S,i,T),Ce("Your code is uploaded!! :)")}catch(i){if(i.message.toLowerCase()==="no port selected by the user."){M.set(O.CLOSE);return}if(i.message.includes("receiveData timeout after")){console.log(i,"eating these errors.  Everything should work!"),Ce("Your code is uploaded!! :)"),M.set(O.CLOSE);return}le("Sorry, please try again in 5 minutes. :)",i)}M.set(O.CLOSE)}}function p(){t(2,r=[])}ze(()=>{a&&t(4,_.scrollTop=_.scrollHeight,_)});function f(){t(1,a=!a)}function h(i){$e[i?"unshift":"push"](()=>{_=i,t(4,_)})}function B(){C=this.value,t(3,C)}return n.$$.update=()=>{n.$$.dirty&1&&t(5,s=u===O.UPLOADING?"fa-spinner fa-spin fa-6x fa-fw":"fa-upload")},[u,a,r,C,_,s,m,k,N,p,f,h,B]}class tt extends ie{constructor(e){super(),ce(this,e,et,xe,ue,{})}}function lt(n){let e,t,s;return t=new tt({}),{c(){e=g("div"),fe(t.$$.fragment),this.h()},l(l){e=b(l,"DIV",{class:!0,slot:!0});var a=y(e);de(t.$$.fragment,a),a.forEach(d),this.h()},h(){o(e,"class","slot-wrapper svelte-1t9h6bw"),o(e,"slot","top")},m(l,a){j(l,e,a),pe(t,e,null),s=!0},p:W,i(l){s||(he(t.$$.fragment,l),s=!0)},o(l){_e(t.$$.fragment,l),s=!1},d(l){l&&d(e),me(t)}}}function st(n){let e,t,s;return t=new Fe({}),{c(){e=g("div"),fe(t.$$.fragment),this.h()},l(l){e=b(l,"DIV",{class:!0,slot:!0});var a=y(e);de(t.$$.fragment,a),a.forEach(d),this.h()},h(){o(e,"class","slot-wrapper svelte-1t9h6bw"),o(e,"slot","bottom")},m(l,a){j(l,e,a),pe(t,e,null),s=!0},p:W,i(l){s||(he(t.$$.fragment,l),s=!0)},o(l){_e(t.$$.fragment,l),s=!1},d(l){l&&d(e),me(t)}}}function at(n){let e,t,s;return e=new Ve({props:{$$slots:{bottom:[st],top:[lt]},$$scope:{ctx:n}}}),{c(){fe(e.$$.fragment),t=I(),this.h()},l(l){de(e.$$.fragment,l),t=A(l),He("svelte-1s918so",document.head).forEach(d),this.h()},h(){document.title="ElectroBlocks - Arduino"},m(l,a){pe(e,l,a),j(l,t,a),s=!0},p(l,[a]){const r={};a&1&&(r.$$scope={dirty:a,ctx:l}),e.$set(r)},i(l){s||(he(e.$$.fragment,l),s=!0)},o(l){_e(e.$$.fragment,l),s=!1},d(l){l&&d(t),me(e,l)}}}class ht extends ie{constructor(e){super(),ce(this,e,null,at,ue,{})}}export{ht as component};
